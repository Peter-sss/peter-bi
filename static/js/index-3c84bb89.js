var ge=Object.defineProperty,he=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var le=(o,d,c)=>d in o?ge(o,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):o[d]=c,J=(o,d)=>{for(var c in d||(d={}))be.call(d,c)&&le(o,c,d[c]);if(se)for(var c of se(d))ye.call(d,c)&&le(o,c,d[c]);return o},W=(o,d)=>he(o,ve(d));var de=(o,d,c)=>new Promise((q,w)=>{var y=i=>{try{v(c.next(i))}catch(x){w(x)}},u=i=>{try{v(c.throw(i))}catch(x){w(x)}},v=i=>i.done?q(i.value):Promise.resolve(i.value).then(y,u);v((c=c.apply(o,d)).next())});import{d as L,j as E,L as K,a as n,o as _,E as H,w as a,b as e,c as k,n as p,u as t,e as h,h as V,bg as _e,Q as pe,a0 as ee,a2 as G,a7 as ae,F as Q,q as ne,aw as ce,t as A,x as qe,y as we,l as xe,d3 as B,aS as X,d2 as re,aT as M,ae as Pe,M as De,bb as Ie,aP as ue,ac as Z,ba as Ce,cD as Se,bt as ke,bu as $e}from"./index-f1b62783.js";import{i as te}from"./icon-14375a60.js";/* empty css                                                                      */import{S as U}from"./SettingItemBox-6b455d4c.js";import{r as Re}from"./chartEditStore-486ae2f4.js";import{n as Ee}from"./noData-e5cefb25.js";import{u as oe}from"./useTargetData.hook-27534cde.js";import{g as me}from"./plugin-a824adf1.js";import"./index-c88c4d15.js";import{R as Oe,a as He}from"./pondIndex.vue_vue_type_style_index_0_scoped_a969325e_lang-51ec6c7b.js";import"./EditorWorker-588d53ae.js";import"./editorWorker-43a98755.js";import"./chartLayoutStore-ce407c49.js";import"./index-22e48ee0.js";import{u as Te}from"./useSync.hook-f803091a.js";import{S as j}from"./SettingItem-d0566dd6.js";import{C as Ue}from"./index-90003018.js";import"./index-08a0b855.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-3590d83e.js";import"./index.esm.min-98f3d51a.js";import"./fileTypeEnum-21359a08.js";import"./project.api-a6799795.js";const ze={class:"go-pr-3"},Ne=h("名称："),Be={key:1},Ae=h("取消"),Fe=h("保存"),je=L({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(o,{emit:d}){const c=o,{dataSyncUpdate:q}=Te();E();const w=E(),y=E(!1);K(()=>c.modelShow,x=>{y.value=x});const u=()=>{d("update:modelShow",!1)},v=()=>{var x,b;if(!((x=c.targetDataRequest)!=null&&x.dataPondName)){window.$message.warning("请在左下角输入名称！"),(b=w.value)==null||b.focus();return}me({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{d("update:modelShow",!1),d("editSaveHandle",c.targetDataRequest),q()}})},i=()=>{u()};return(x,b)=>{const r=n("n-space"),P=n("n-scrollbar"),D=n("n-tag"),$=n("n-input"),R=n("n-button"),O=n("n-card"),I=n("n-modal");return _(),H(I,{class:"go-chart-data-request",show:y.value,"onUpdate:show":b[1]||(b[1]=S=>y.value=S),"mask-closable":!1,closeOnEsc:!0,onEsc:i},{default:a(()=>[e(O,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:a(()=>[]),"header-extra":a(()=>[]),action:a(()=>[e(r,{justify:"space-between"},{default:a(()=>[o.targetDataRequest?(_(),H(r,{key:0},{default:a(()=>[e(D,{bordered:!1,type:"primary"},{default:a(()=>[Ne]),_:1}),e($,{value:o.targetDataRequest.dataPondName,"onUpdate:value":b[0]||(b[0]=S=>o.targetDataRequest.dataPondName=S),ref_key:"inputInstRef",ref:w,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(_(),k("span",Be)),e(r,null,{default:a(()=>[e(R,{onClick:u},{default:a(()=>[Ae]),_:1}),e(R,{type:"primary",onClick:v},{default:a(()=>[Fe]),_:1})]),_:1})]),_:1})]),default:a(()=>[e(P,{style:{"max-height":"718px"}},{default:a(()=>[p("div",ze,[e(r,{vertical:""},{default:a(()=>{var S;return[e(t(Oe)),e(t(He),{"target-data-request":(S=o.targetDataRequest)==null?void 0:S.dataPondRequestConfig},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Le=V(je,[["__scopeId","data-v-a969325e"]]),Me=o=>(qe("data-v-43dfb7fe"),o=o(),we(),o),Ge={class:"go-chart-data-pond-list"},Ve={class:"pond-item-box"},Qe=Me(()=>p("span",null," 创建 ",-1)),Ye=h(" 暂无数据内容， "),Je=h("立即创建"),We=["onClick"],Xe={class:"item-content"},Ke={class:"item-content-body"},Ze=h(" 名称 "),et=h(" 地址 "),tt=["onClick"],at=L({__name:"index",emits:["createPond","deletePond"],setup(o,{emit:d}){_e(D=>({"1013e1a5":t(x)}));const{DuplicateOutlineIcon:c,TrashIcon:q}=te.ionicons5,w=pe(),{chartEditStore:y,targetData:u}=oe(),{requestDataPond:v}=ee(y.getRequestGlobalConfig),i=G(()=>u.value.request.requestDataPondId),x=G(()=>w.getAppTheme),b=()=>{d("createPond",!0)},r=(D,$)=>{D.stopPropagation(),D.preventDefault(),d("deletePond",$)},P=D=>{u.value.request.requestDataPondId=D.dataPondId};return(D,$)=>{const R=n("n-timeline-item"),O=n("n-timeline"),I=n("n-icon"),S=n("n-button"),z=n("n-divider"),C=n("n-a"),f=n("n-text"),s=n("n-space"),m=n("n-tag"),g=n("n-ellipsis"),T=n("n-scrollbar");return _(),k("div",Ge,[e(O,{class:"pond-item-timeline",style:{width:"20px"}},{default:a(()=>[e(R,{type:"info"}),e(R,{type:"success"})]),_:1}),p("div",Ve,[e(S,{class:"create-btn go-py-4",ghost:"",onClick:b},{icon:a(()=>[e(I,null,{default:a(()=>[e(t(c))]),_:1})]),default:a(()=>[Qe]),_:1}),e(z,{style:{margin:"10px 0"}}),t(v).length?ae("",!0):(_(),H(s,{key:0,justify:"center"},{default:a(()=>[e(f,{class:"not-layer-text",depth:3},{default:a(()=>[Ye,e(C,{onClick:b},{default:a(()=>[Je]),_:1})]),_:1})]),_:1})),e(T,{style:{"max-height":"490px"}},{default:a(()=>[(_(!0),k(Q,null,ne(t(v),l=>(_(),k("div",{key:l.dataPondId,class:ce([{select:l.dataPondId===t(i)},"pond-item"]),onClick:F=>P(l)},[p("div",Xe,[p("div",Ke,[p("div",null,[e(m,{class:"go-mr-1",type:l.dataPondId===t(i)?"warning":"",bordered:!1},{default:a(()=>[Ze]),_:2},1032,["type"]),e(g,{style:{"max-width":"180px"}},{default:a(()=>[h(A(l.dataPondName||"暂无"),1)]),_:2},1024)]),p("div",null,[e(m,{class:"go-mr-1",type:l.dataPondId===t(i)?"warning":"",bordered:!1},{default:a(()=>[et]),_:2},1032,["type"]),e(g,{style:{"max-width":"180px"}},{default:a(()=>[h(A(l.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),p("div",{class:"item-content-icon go-transition-quick",onClick:F=>r(F,l)},[e(I,null,{default:a(()=>[e(t(q))]),_:1})],8,tt)]),p("div",{class:ce({"select-modal":l.dataPondId===t(i)})},null,2)],10,We))),128))]),_:1})])])}}});const nt=V(at,[["__scopeId","data-v-43dfb7fe"]]),ot=p("thead",null,[p("tr",null,[p("th",null,"key"),p("th",null,"value")])],-1),ie=L({__name:"displayTable",props:{target:Object},setup(o){const d=o,c={key:"",value:""},q=xe({content:[]});return K(()=>d.target,w=>{q.content=[];for(const y in w)q.content.push({key:y,value:w[y]});q.content.length||(q.content=[JSON.parse(JSON.stringify(c))])},{immediate:!0,deep:!0}),(w,y)=>{const u=n("n-table");return _(),H(u,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:a(()=>[ot,p("tbody",null,[(_(!0),k(Q,null,ne(q.content,(v,i)=>(_(),k("tr",{key:i},[p("td",null,A(v.key||"暂无"),1),p("td",null,A(v.value||"暂无"),1)]))),128))])]),_:1})}}}),st={class:"go-chart-data-display"},lt={class:"go-mr-3"},dt={key:0},ct={class:"go-mt-3"},rt={key:0},ut={key:1},it=h("该接口没有 Body 体"),_t={key:1},pt=h("sql"),mt=L({__name:"index",props:{globalData:Object,targetData:Object},setup(o){const d=o,{HelpOutlineIcon:c,FlashIcon:q,PulseIcon:w}=te.ionicons5,{requestUrl:y,requestInterval:u,requestHttpType:v,requestContentType:i,requestSQLContent:x,requestParams:b,requestParamsBodyType:r,requestIntervalUnit:P}=ee(d.targetData.dataPondRequestConfig);B.HEADER;const D={[X.DEFAULT]:"普通请求",[X.SQL]:"SQL 请求"},$=E(B.PARAMS);return(R,O)=>{const I=n("n-input"),S=n("n-icon"),z=n("n-divider"),C=n("n-tab"),f=n("n-tabs"),s=n("n-text"),m=n("n-card"),g=n("n-code"),T=n("n-scrollbar");return _(),k("div",st,[e(T,{style:{"max-height":"570px"}},{default:a(()=>[p("div",lt,[p("div",null,[e(t(U),{name:"主体信息"},{default:a(()=>[e(t(j),{name:"接口名称"},{default:a(()=>{var l;return[e(I,{size:"small",placeholder:((l=o.targetData)==null?void 0:l.dataPondName)||"暂无",disabled:!0},null,8,["placeholder"])]}),_:1}),e(t(j),{name:"接口类型"},{default:a(()=>[e(I,{size:"small",placeholder:t(v)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(t(U),null,{default:a(()=>[e(t(j),{name:"组件间隔"},{default:a(()=>[e(I,{size:"small",placeholder:`${t(u)||"暂无"}`,disabled:!0},{suffix:a(()=>[h(A(o.targetData&&t(re)[t(P)]),1)]),_:1},8,["placeholder"])]),_:1}),e(t(j),{name:"全局间隔（默认）"},{default:a(()=>{var l;return[e(I,{size:"small",placeholder:`${((l=o.globalData)==null?void 0:l.requestInterval)||"暂无"}`,disabled:!0},{suffix:a(()=>[h(A(o.globalData&&t(re)[o.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]}),_:1})]),_:1}),e(t(U),{name:"源地址",alone:!0},{default:a(()=>{var l;return[e(I,{size:"small",placeholder:((l=o.globalData)==null?void 0:l.requestOriginUrl)||"暂无",disabled:!0},{prefix:a(()=>[e(S,{component:t(w)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(t(U),{name:"接口地址",alone:!0},{default:a(()=>[e(I,{size:"small",placeholder:t(y)||"暂无",disabled:!0},{prefix:a(()=>[e(S,{component:t(q)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(z),e(t(U),{name:"类型"},{default:a(()=>[e(t(j),{name:"配置类型"},{default:a(()=>[e(I,{size:"small",placeholder:o.targetData&&D[t(i)],disabled:!0},null,8,["placeholder"])]),_:1}),t(i)===t(X).DEFAULT?(_(),H(t(j),{key:0,name:"body 类型"},{default:a(()=>[e(I,{size:"small",placeholder:o.targetData&&t(r),disabled:!0},null,8,["placeholder"])]),_:1})):ae("",!0)]),_:1}),t(i)===t(X).DEFAULT?(_(),k("div",dt,[e(f,{type:"line",animated:"",value:$.value,"onUpdate:value":O[0]||(O[0]=l=>$.value=l)},{default:a(()=>[(_(!0),k(Q,null,ne(t(B),l=>(_(),H(C,{key:l,name:l,tab:l},{default:a(()=>[h(A(l),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),p("div",ct,[$.value!==t(B).BODY?(_(),k("div",rt,[e(ie,{class:"go-my-3",target:t(b)[$.value]},null,8,["target"])])):(_(),k("div",ut,[t(r)===t(M).NONE?(_(),H(m,{key:0,class:"go-mt-3 go-pb-3"},{default:a(()=>[e(s,{depth:"3"},{default:a(()=>[it]),_:1})]),_:1})):t(r)===t(M).FORM_DATA||t(r)===t(M).X_WWW_FORM_URLENCODED?(_(),H(ie,{key:1,class:"go-my-3",target:t(b)[t(B).BODY][t(r)]},null,8,["target"])):t(r)===t(M).JSON?(_(),H(m,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:a(()=>[e(g,{code:t(b)[t(B).BODY][t(r)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):t(r)===t(M).XML?(_(),H(g,{key:3,code:t(b)[t(B).BODY][t(r)]||"",language:"html"},null,8,["code"])):ae("",!0)]))])])):(_(),k("div",_t,[e(t(U),{name:"键名"},{default:a(()=>[e(s,null,{default:a(()=>[pt]),_:1})]),_:1}),e(t(U),{name:"键值"},{default:a(()=>[e(g,{code:t(x).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const ft=V(mt,[["__scopeId","data-v-cc877db2"]]),gt={class:"pond-content"},ht={key:1,class:"no-data go-flex-center"},vt=["src"],bt=h("暂未选择公共接口"),yt=h(" 编辑内容 "),qt=h("取消"),wt=h("保存 & 发送请求"),xt=L({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(o,{emit:d}){const c=o,{PencilIcon:q}=te.ionicons5,{chartEditStore:w,targetData:y}=oe(),{requestDataPond:u}=ee(w.getRequestGlobalConfig),v=E(!1),i=E(!1),x=E(!1),b=E(!1),r=E(),P=G(()=>{var g,T;const s=(T=(g=y==null?void 0:y.value)==null?void 0:g.request)==null?void 0:T.requestDataPondId;return s?u.value.filter(l=>s===l.dataPondId)[0]:void 0});K(()=>c.modelShow,s=>{i.value=s}),K(()=>P.value,s=>{x.value=!0,r.value=s,Pe(()=>{x.value=!1})},{immediate:!0});const D=(s=!1)=>{b.value=!!s,v.value=!0},$=()=>{const s=De();r.value={dataPondId:s,dataPondName:s,dataPondRequestConfig:Ie.cloneDeep(W(J({},Re),{requestDataType:ue.Pond}))},D()},R=s=>{b.value?O(s):I(s),b.value=!1,v.value=!1},O=s=>{try{const m=u.value.findIndex(g=>g.dataPondId===s.dataPondId);m!==-1?(u.value.splice(m,1,s),w.getComponentList.forEach(g=>{g.request.requestDataType===ue.Pond&&g.request.requestDataPondId===s.dataPondId&&(g.request=W(J({},Z(s.dataPondRequestConfig)),{requestDataPondId:s.dataPondId}))}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch(m){window.$message.error("编辑失败，请稍后重试！")}},I=s=>{try{r.value?(u.value.unshift(s),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch(m){window.$message.error("创建失败，请稍后重试!")}},S=s=>{me({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const m=u.value.findIndex(g=>g.dataPondId===s.dataPondId);m!==-1?(u.value.splice(m,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},z=()=>{P.value&&(y.value.request=W(J({},Z(P.value.dataPondRequestConfig)),{requestDataPondId:P.value.dataPondId})),d("update:modelShow",!1),d("sendHandle")},C=()=>{d("update:modelShow",!1)},f=()=>{C()};return(s,m)=>{const g=n("n-text"),T=n("n-icon"),l=n("n-button"),F=n("n-space"),N=n("n-card"),fe=n("n-modal");return _(),k(Q,null,[e(fe,{class:"go-chart-data-pond-control",show:i.value,"onUpdate:show":m[1]||(m[1]=Y=>i.value=Y),"mask-closable":!1,"close-on-esc":!0,onEsc:f},{default:a(()=>[e(N,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:a(()=>[]),"header-extra":a(()=>[]),action:a(()=>[e(F,{justify:"space-between"},{default:a(()=>[e(l,{type:"info",secondary:"",disabled:!t(P),onClick:m[0]||(m[0]=Y=>D(!0))},{icon:a(()=>[e(T,null,{default:a(()=>[e(t(q))]),_:1})]),default:a(()=>[yt]),_:1},8,["disabled"]),p("div",null,[e(l,{class:"go-mr-3",onClick:C},{default:a(()=>[qt]),_:1}),e(l,{type:"primary",onClick:z},{default:a(()=>[wt]),_:1})])]),_:1})]),default:a(()=>[p("div",gt,[t(P)&&!x.value?(_(),H(t(ft),{key:0,targetData:t(P),globalData:t(w).getRequestGlobalConfig},null,8,["targetData","globalData"])):(_(),k("div",ht,[p("img",{src:t(Ee),alt:"暂无数据"},null,8,vt),e(g,{depth:3},{default:a(()=>[bt]),_:1})])),e(t(nt),{onCreatePond:$,onDeletePond:S})])]),_:1})]),_:1},8,["show"]),e(t(Le),{modelShow:v.value,"onUpdate:modelShow":m[2]||(m[2]=Y=>v.value=Y),targetDataRequest:r.value,isEdit:b.value,onEditSaveHandle:R},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}});const Pt=V(xt,[["__scopeId","data-v-cb258d69"]]),Dt={class:"go-chart-data-pond"},It={class:"go-absolute-center"},Ct=h("编辑配置"),St=h(" 测试 "),kt=h(" 默认赋值给 dataset 字段 "),$t=h(" 发送请求 "),Rt=L({__name:"index",setup(o){_e(C=>({"5189590e":t(I)}));const d=pe(),{HelpOutlineIcon:c,FlashIcon:q,PulseIcon:w,FishIcon:y}=te.ionicons5,{targetData:u,chartEditStore:v}=oe(),{requestDataPond:i,requestInterval:x,requestIntervalUnit:b}=ee(v.getRequestGlobalConfig),r=E(!1),P=E(!1),D=E(!1);let $=0,R;const O=G(()=>{const C=u.value.request.requestDataPondId;return C?i.value.filter(s=>C===s.dataPondId)[0]:void 0}),I=G(()=>d.getAppTheme),S=()=>{P.value=!0},z=()=>de(this,null,function*(){var C;if(!((C=u.value)!=null&&C.request)){window.$message.warning("请选择一个公共接口！");return}r.value=!0;try{const f=yield ke(Z(u.value.request),Z(v.getRequestGlobalConfig));if(r.value=!1,f){if(!(f!=null&&f.data)&&!u.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),D.value=!0;return}u.value.option.dataset=$e(f==null?void 0:f.data,f,u.value.filter),D.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(f){console.error(f),r.value=!1,window.$message.warning("数据异常，请检查参数！")}});return Ce(()=>{var f;const C=(f=u.value)==null?void 0:f.filter;R!==C&&$&&(R=C,z()),$++}),Se(()=>{R=null}),(C,f)=>{const s=n("n-icon"),m=n("n-input"),g=n("n-button"),T=n("n-card"),l=n("n-tooltip"),F=n("go-skeleton");return _(),k(Q,null,[p("div",Dt,[e(T,{class:"n-card-shallow"},{default:a(()=>[e(t(U),{name:"请求名称",alone:!0},{default:a(()=>{var N;return[e(m,{size:"small",placeholder:((N=t(O))==null?void 0:N.dataPondName)||"暂无",disabled:!0},{prefix:a(()=>[e(s,{component:t(y)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(t(U),{name:"接口地址",alone:!0},{default:a(()=>{var N;return[e(m,{size:"small",placeholder:((N=t(O))==null?void 0:N.dataPondRequestConfig.requestUrl)||"暂无",disabled:!0},{prefix:a(()=>[e(s,{component:t(q)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),p("div",{class:"edit-text",onClick:S},[p("div",It,[e(g,{type:"primary",secondary:""},{default:a(()=>[Ct]),_:1})])])]),_:1})]),e(t(U),{alone:!0},{name:a(()=>[St,e(l,{trigger:"hover"},{trigger:a(()=>[e(s,{size:"21",depth:3},{default:a(()=>[e(t(c))]),_:1})]),default:a(()=>[kt]),_:1})]),default:a(()=>[e(g,{type:"primary",ghost:"",onClick:z},{icon:a(()=>[e(s,null,{default:a(()=>[e(t(q))]),_:1})]),default:a(()=>[$t]),_:1})]),_:1}),e(t(Ue),{show:D.value&&!r.value,ajax:!0},null,8,["show"]),e(F,{load:r.value,repeat:3},null,8,["load"]),e(t(Pt),{modelShow:P.value,"onUpdate:modelShow":f[0]||(f[0]=N=>P.value=N),onSendHandle:z},null,8,["modelShow"])],64)}}});const ta=V(Rt,[["__scopeId","data-v-19fefd48"]]);export{ta as default};
