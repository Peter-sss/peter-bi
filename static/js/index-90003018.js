var X=(v,_,x)=>new Promise((E,f)=>{var g=r=>{try{p(x.next(r))}catch(h){f(h)}},l=r=>{try{p(x.throw(r))}catch(h){f(h)}},p=r=>r.done?E(r.value):Promise.resolve(r.value).then(g,l);p((x=x.apply(v,_)).next())});import{d as oe,a0 as Y,j as S,a2 as P,ad as de,d4 as A,L as ne,a,o as b,c as B,u as n,E as R,w as e,b as t,n as i,F as J,e as s,bt as ue,ac as K,x as _e,y as fe,h as ae,ae as pe,c_ as me,aM as he,cY as ve,aL as ge,aP as ye,b5 as we,U as Q,V as W,q as Z,t as z,bl as be,a7 as xe}from"./index-f1b62783.js";import{d as ee}from"./chartEditStore-486ae2f4.js";import{i as L}from"./icon-14375a60.js";import{T as H,D}from"./index-c88c4d15.js";import{u as le}from"./useTargetData.hook-27534cde.js";import{M as Ce}from"./EditorWorker-588d53ae.js";import"./editorWorker-43a98755.js";import{g as Se}from"./plugin-a824adf1.js";import{F as te}from"./fileTypeEnum-21359a08.js";const G=v=>(_e("data-v-eac7a30e"),v=v(),fe(),v),ke=G(()=>i("p",null,[i("span",{class:"func-keyword"},"function"),s("  filter(data, res)  {")],-1)),Fe={class:"go-ml-4"},Te=G(()=>i("p",null,"}",-1)),Ee=s(" 编辑 "),Re=s(" 删除 "),qe=s(" 新增过滤器 "),$e=s("过滤器函数编辑器"),je=G(()=>i("span",{class:"func-keyword"},"function",-1)),Ie=s("  filter(data, res)  { "),Ue=s("}"),Ne={class:"editor-data-show"},ze=s("默认过滤数据(data)："),De={class:"editor-data-show"},Ae=s("接口返回数据(res)："),Be={class:"editor-data-show"},Le=s("过滤器结果："),Ve={class:"go-flex-items-center"},Me=s(" 规则 "),Oe=s("过滤器默认处理接口返回值的「data」字段"),He=s("取消"),Pe=s("保存"),Je=oe({__name:"index",setup(v){const{DocumentTextIcon:_}=L.ionicons5,{FilterIcon:x,FilterEditIcon:E}=L.carbon,{targetData:f,chartEditStore:g}=le();Y(f.value.request),Y(g.getRequestGlobalConfig);const l=S(!1),p=S(f.value.filter||"return data"),r=S(!1),h=S(""),q=()=>X(this,null,function*(){try{const m=yield ue(K(f.value.request),K(g.getRequestGlobalConfig));if(m){h.value=m;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(m){console.error(m),window.$message.warning("数据异常，请检查参数！")}}),V=P(()=>{try{const m=new Function("data","res",p.value),y=de(h.value),o=m(y==null?void 0:y.data,y);return r.value=!1,A(o)}catch(m){return r.value=!0,`过滤函数错误，日志：${m}`}}),j=()=>{l.value=!0},M=()=>{Se({message:"是否删除过滤器",onPositiveCallback:()=>{f.value.filter=void 0}})},I=()=>{l.value=!1},U=()=>{if(r.value){window.$message.error("过滤函数错误，无法进行保存");return}f.value.filter=p.value,I()};return ne(()=>l.value,m=>{m&&(q(),p.value=f.value.filter||"return data")}),(m,y)=>{const o=a("n-code"),c=a("n-icon"),u=a("n-button"),d=a("n-space"),C=a("n-card"),F=a("n-text"),T=a("n-tag"),$=a("n-divider"),N=a("n-scrollbar"),O=a("n-modal");return b(),B(J,null,[n(f).filter?(b(),R(C,{key:0},{footer:e(()=>[t(d,{justify:"end"},{default:e(()=>[t(u,{type:"primary",tertiary:"",size:"small",onClick:j},{icon:e(()=>[t(c,null,{default:e(()=>[t(n(E))]),_:1})]),default:e(()=>[Ee]),_:1}),t(u,{tertiary:"",size:"small",onClick:M},{default:e(()=>[Re]),_:1})]),_:1})]),default:e(()=>[ke,i("div",Fe,[t(o,{code:n(f).filter,language:"typescript"},null,8,["code"])]),Te]),_:1})):(b(),R(u,{key:1,class:"go-ml-3",onClick:j},{icon:e(()=>[t(c,null,{default:e(()=>[t(n(x))]),_:1})]),default:e(()=>[qe]),_:1})),t(O,{class:"go-chart-data-monaco-editor",show:l.value,"onUpdate:show":y[1]||(y[1]=k=>l.value=k),"mask-closable":!1,closeOnEsc:!1},{default:e(()=>[t(C,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"600px"}},{header:e(()=>[t(d,null,{default:e(()=>[t(F,null,{default:e(()=>[$e]),_:1})]),_:1})]),"header-extra":e(()=>[]),action:e(()=>[t(d,{justify:"space-between"},{default:e(()=>[i("div",Ve,[t(T,{bordered:!1,type:"primary"},{icon:e(()=>[t(c,{component:n(_)},null,8,["component"])]),default:e(()=>[Me]),_:1}),t(F,{class:"go-ml-2",depth:"2"},{default:e(()=>[Oe]),_:1})]),t(d,null,{default:e(()=>[t(u,{size:"medium",onClick:I},{default:e(()=>[He]),_:1}),t(u,{size:"medium",type:"primary",onClick:U},{default:e(()=>[Pe]),_:1})]),_:1})]),_:1})]),default:e(()=>[t(d,{size:"small",vertical:""},{default:e(()=>[t(d,{justify:"space-between"},{default:e(()=>[i("div",null,[t(d,{vertical:""},{default:e(()=>[t(T,{type:"info"},{default:e(()=>[je,Ie]),_:1}),t(n(Ce),{modelValue:p.value,"onUpdate:modelValue":y[0]||(y[0]=k=>p.value=k),width:"460px",height:"380px",language:"javascript"},null,8,["modelValue"]),t(T,{type:"info"},{default:e(()=>[Ue]),_:1})]),_:1})]),t($,{vertical:"",style:{height:"480px"}}),t(N,{style:{"max-height":"480px"}},{default:e(()=>[t(d,{size:15,vertical:""},{default:e(()=>[i("div",Ne,[t(d,null,{default:e(()=>{var k;return[t(F,{depth:"3"},{default:e(()=>[ze]),_:1}),t(o,{code:n(A)((k=h.value)==null?void 0:k.data)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]}),_:1})]),i("div",De,[t(d,null,{default:e(()=>[t(F,{depth:"3"},{default:e(()=>[Ae]),_:1}),t(o,{code:n(A)(h.value)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]),_:1})]),i("div",Be,[t(d,null,{default:e(()=>[t(F,{depth:"3"},{default:e(()=>[Le]),_:1}),t(o,{code:n(V)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64)}}});const Ge=ae(Je,[["__scopeId","data-v-eac7a30e"]]),Xe=v=>{const _=S();return{uploadFileListRef:_,beforeUpload:({file:g})=>{_.value=[];const l=g.file.type;return l!==te.JSON&&l!==te.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},customRequest:g=>{const{file:l}=g;pe(()=>{l.file?me(l.file).then(p=>{v.value.option.dataset=he(p)}):window.$message.error("导入数据失败，请稍后重试或联系管理员！")})},download:()=>{try{window.$message.success("下载中，请耐心等待..."),ve(ge(v.value.option.dataset),void 0,"json")}catch(g){window.$message.error("下载失败，数据错误！")}}}},Ye=s("无"),Ke=s("过滤器默认处理接口返回值的「data」字段"),Qe=s(" 导入（json / txt） "),We=s(" 下载 "),Ze=s("点击【下载】查看完整数据"),et=oe({__name:"index",props:{show:{type:Boolean,required:!1},ajax:{type:Boolean,required:!0}},setup(v){const{targetData:_}=le(),x=["字段","映射","状态"],{HelpOutlineIcon:E}=L.ionicons5,{DocumentAddIcon:f,DocumentDownloadIcon:g}=L.carbon,l=S(),p=S(),r=S(),h=S(!1),{uploadFileListRef:q,customRequest:V,beforeUpload:j,download:M}=Xe(_),I=P(()=>_.value.request.requestDataType!==ye.STATIC),U=P(()=>_.value.chartConfig.chartFrame===ee.ECHARTS),m=o=>{let c=D.SUCCESS;for(let u=0;u<l.value.length;u++)if(l.value[u][o]===void 0)return c=D.FAILURE,c;return D.SUCCESS},y=()=>{try{return p.value.map((o,c)=>c===0?{field:"通用标识",mapping:o,result:D.NULL}:{field:`数据项-${c}`,mapping:o,result:m(o)})}catch(o){return[]}};return ne(()=>{var o,c;return(c=(o=_.value)==null?void 0:o.option)==null?void 0:c.dataset},o=>{var c,u;o&&((u=(c=_==null?void 0:_.value)==null?void 0:c.chartConfig)==null?void 0:u.chartFrame)===ee.ECHARTS?(l.value=o,U.value&&(p.value=o.dimensions,r.value=y())):o!=null?(r.value=null,l.value=o):(h.value=!0,l.value="此组件无数据源"),we(o)&&(r.value=null)},{immediate:!0}),(o,c)=>{const u=a("n-badge"),d=a("n-text"),C=a("n-space"),F=a("n-table"),T=a("n-timeline-item"),$=a("n-icon"),N=a("n-button"),O=a("n-upload"),k=a("n-tooltip"),se=a("n-code"),ce=a("n-card"),ie=a("n-timeline");return b(),R(ie,{class:"go-chart-configurations-timeline"},{default:e(()=>[Q(t(T,{type:"info",title:n(H).MAPPING},{default:e(()=>[t(F,{striped:""},{default:e(()=>[i("thead",null,[i("tr",null,[(b(),B(J,null,Z(x,w=>i("th",{key:w},z(w),1)),64))])]),i("tbody",null,[(b(!0),B(J,null,Z(r.value,(w,re)=>(b(),B("tr",{key:re},[i("td",null,z(w.field),1),i("td",null,z(w.mapping),1),i("td",null,[w.result===0?(b(),R(C,{key:0},{default:e(()=>[t(u,{dot:"",type:"success"}),t(d,null,{default:e(()=>[Ye]),_:1})]),_:1})):(b(),R(C,{key:1},{default:e(()=>[t(u,{dot:"",type:w.result===1?"success":"error"},null,8,["type"]),t(d,null,{default:e(()=>[s("匹配"+z(w.result===1?"成功":"失败"),1)]),_:2},1024)]),_:2},1024))])]))),128))])]),_:1})]),_:1},8,["title"]),[[W,n(U)&&r.value]]),Q(t(T,{color:"#97846c",title:n(H).FILTER},{default:e(()=>[t(C,{size:18,vertical:""},{default:e(()=>[t(d,{depth:"3"},{default:e(()=>[Ke]),_:1}),t(n(Ge))]),_:1})]),_:1},8,["title"]),[[W,n(I)]]),t(T,{type:"success",title:n(H).CONTENT},{default:e(()=>[t(C,{vertical:""},{default:e(()=>[t(C,{class:"source-btn-box"},{default:e(()=>[t(O,{"file-list":n(q),"onUpdate:file-list":c[0]||(c[0]=w=>be(q)?q.value=w:null),"show-file-list":!1,customRequest:n(V),onBeforeUpload:n(j)},{default:e(()=>[t(C,null,{default:e(()=>[v.ajax?xe("",!0):(b(),R(N,{key:0,class:"sourceBtn-item",disabled:h.value},{icon:e(()=>[t($,null,{default:e(()=>[t(n(f))]),_:1})]),default:e(()=>[Qe]),_:1},8,["disabled"]))]),_:1})]),_:1},8,["file-list","customRequest","onBeforeUpload"]),i("div",null,[t(N,{class:"sourceBtn-item",disabled:h.value,onClick:n(M)},{icon:e(()=>[t($,null,{default:e(()=>[t(n(g))]),_:1})]),default:e(()=>[We]),_:1},8,["disabled","onClick"]),t(k,{trigger:"hover"},{trigger:e(()=>[t($,{class:"go-ml-1",size:"21",depth:3},{default:e(()=>[t(n(E))]),_:1})]),default:e(()=>[t(d,{depth:"3"},{default:e(()=>[Ze]),_:1})]),_:1})])]),_:1}),t(ce,{size:"small"},{default:e(()=>[t(se,{code:n(A)(l.value),language:"json"},null,8,["code"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1})}}});const ut=ae(et,[["__scopeId","data-v-f6d90859"]]);export{ut as C};
