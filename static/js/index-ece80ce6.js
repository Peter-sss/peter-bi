var Q=(v,_,x)=>new Promise((R,f)=>{var g=i=>{try{p(x.next(i))}catch(h){f(h)}},l=i=>{try{p(x.throw(i))}catch(h){f(h)}},p=i=>i.done?R(i.value):Promise.resolve(i.value).then(g,l);p((x=x.apply(v,_)).next())});import{d as oe,W,r as S,Y as J,a5 as ue,cQ as A,J as ne,x as a,c as b,e as B,l as n,B as E,w as e,h as t,f as r,F as P,p as s,a4 as K,y as de,z as _e,A as ae,a6 as fe,cK as pe,aD as me,cI as he,aC as ve,aF as ge,aW as ye,O as X,Q as Y,j as Z,t as N,bb as we,a2 as be}from"./index-aa7518de.js";import{c as ee}from"./chartEditStore-dcae2239.js";import{i as O}from"./icon-49f969d0.js";import{T as M,D as U}from"./index-2a90f4b0.js";import{u as le}from"./useTargetData.hook-30f23be8.js";import{M as xe}from"./EditorWorker-d94027f7.js";import"./editorWorker-43a98755.js";import{g as Ce}from"./plugin-2ac2d336.js";import{c as Se}from"./http-52934de2.js";import{F as te}from"./fileTypeEnum-21359a08.js";const G=v=>(de("data-v-eac7a30e"),v=v(),_e(),v),Fe=G(()=>r("p",null,[r("span",{class:"func-keyword"},"function"),s("  filter(data, res)  {")],-1)),ke={class:"go-ml-4"},Te=G(()=>r("p",null,"}",-1)),Re=s(" 编辑 "),Ee=s(" 删除 "),$e=s(" 新增过滤器 "),qe=s("过滤器函数编辑器"),Ie=G(()=>r("span",{class:"func-keyword"},"function",-1)),je=s("  filter(data, res)  { "),ze=s("}"),De={class:"editor-data-show"},Ne=s("默认过滤数据(data)："),Ue={class:"editor-data-show"},Ae=s("接口返回数据(res)："),Be={class:"editor-data-show"},Oe=s("过滤器结果："),Le={class:"go-flex-items-center"},Ve=s(" 规则 "),He=s("过滤器默认处理接口返回值的「data」字段"),Me=s("取消"),Je=s("保存"),Pe=oe({__name:"index",setup(v){const{DocumentTextIcon:_}=O.ionicons5,{FilterIcon:x,FilterEditIcon:R}=O.carbon,{targetData:f,chartEditStore:g}=le();W(f.value.request),W(g.getRequestGlobalConfig);const l=S(!1),p=S(f.value.filter||"return data"),i=S(!1),h=S(""),$=()=>Q(this,null,function*(){try{const m=yield Se(K(f.value.request),K(g.getRequestGlobalConfig));if(m){h.value=m;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(m){console.error(m),window.$message.warning("数据异常，请检查参数！")}}),L=J(()=>{try{const m=new Function("data","res",p.value),y=ue(h.value),o=m(y==null?void 0:y.data,y);return i.value=!1,A(o)}catch(m){return i.value=!0,`过滤函数错误，日志：${m}`}}),I=()=>{l.value=!0},V=()=>{Ce({message:"是否删除过滤器",onPositiveCallback:()=>{f.value.filter=void 0}})},j=()=>{l.value=!1},z=()=>{if(i.value){window.$message.error("过滤函数错误，无法进行保存");return}f.value.filter=p.value,j()};return ne(()=>l.value,m=>{m&&($(),p.value=f.value.filter||"return data")}),(m,y)=>{const o=a("n-code"),c=a("n-icon"),d=a("n-button"),u=a("n-space"),C=a("n-card"),k=a("n-text"),T=a("n-tag"),q=a("n-divider"),D=a("n-scrollbar"),H=a("n-modal");return b(),B(P,null,[n(f).filter?(b(),E(C,{key:0},{footer:e(()=>[t(u,{justify:"end"},{default:e(()=>[t(d,{type:"primary",tertiary:"",size:"small",onClick:I},{icon:e(()=>[t(c,null,{default:e(()=>[t(n(R))]),_:1})]),default:e(()=>[Re]),_:1}),t(d,{tertiary:"",size:"small",onClick:V},{default:e(()=>[Ee]),_:1})]),_:1})]),default:e(()=>[Fe,r("div",ke,[t(o,{code:n(f).filter,language:"typescript"},null,8,["code"])]),Te]),_:1})):(b(),E(d,{key:1,class:"go-ml-3",onClick:I},{icon:e(()=>[t(c,null,{default:e(()=>[t(n(x))]),_:1})]),default:e(()=>[$e]),_:1})),t(H,{class:"go-chart-data-monaco-editor",show:l.value,"onUpdate:show":y[1]||(y[1]=F=>l.value=F),"mask-closable":!1,closeOnEsc:!1},{default:e(()=>[t(C,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"600px"}},{header:e(()=>[t(u,null,{default:e(()=>[t(k,null,{default:e(()=>[qe]),_:1})]),_:1})]),"header-extra":e(()=>[]),action:e(()=>[t(u,{justify:"space-between"},{default:e(()=>[r("div",Le,[t(T,{bordered:!1,type:"primary"},{icon:e(()=>[t(c,{component:n(_)},null,8,["component"])]),default:e(()=>[Ve]),_:1}),t(k,{class:"go-ml-2",depth:"2"},{default:e(()=>[He]),_:1})]),t(u,null,{default:e(()=>[t(d,{size:"medium",onClick:j},{default:e(()=>[Me]),_:1}),t(d,{size:"medium",type:"primary",onClick:z},{default:e(()=>[Je]),_:1})]),_:1})]),_:1})]),default:e(()=>[t(u,{size:"small",vertical:""},{default:e(()=>[t(u,{justify:"space-between"},{default:e(()=>[r("div",null,[t(u,{vertical:""},{default:e(()=>[t(T,{type:"info"},{default:e(()=>[Ie,je]),_:1}),t(n(xe),{modelValue:p.value,"onUpdate:modelValue":y[0]||(y[0]=F=>p.value=F),width:"460px",height:"380px",language:"javascript"},null,8,["modelValue"]),t(T,{type:"info"},{default:e(()=>[ze]),_:1})]),_:1})]),t(q,{vertical:"",style:{height:"480px"}}),t(D,{style:{"max-height":"480px"}},{default:e(()=>[t(u,{size:15,vertical:""},{default:e(()=>[r("div",De,[t(u,null,{default:e(()=>{var F;return[t(k,{depth:"3"},{default:e(()=>[Ne]),_:1}),t(o,{code:n(A)((F=h.value)==null?void 0:F.data)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]}),_:1})]),r("div",Ue,[t(u,null,{default:e(()=>[t(k,{depth:"3"},{default:e(()=>[Ae]),_:1}),t(o,{code:n(A)(h.value)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]),_:1})]),r("div",Be,[t(u,null,{default:e(()=>[t(k,{depth:"3"},{default:e(()=>[Oe]),_:1}),t(o,{code:n(L)||"暂无",language:"json","word-wrap":!0},null,8,["code"])]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64)}}});const Ge=ae(Pe,[["__scopeId","data-v-eac7a30e"]]),Qe=v=>{const _=S();return{uploadFileListRef:_,beforeUpload:({file:g})=>{_.value=[];const l=g.file.type;return l!==te.JSON&&l!==te.TXT?(window.$message.warning("仅支持上传 【JSON】 格式文件，请重新上传！"),!1):!0},customRequest:g=>{const{file:l}=g;fe(()=>{l.file?pe(l.file).then(p=>{v.value.option.dataset=me(p)}):window.$message.error("导入数据失败，请稍后重试或联系管理员！")})},download:()=>{try{window.$message.success("下载中，请耐心等待..."),he(ve(v.value.option.dataset),void 0,"json")}catch(g){window.$message.error("下载失败，数据错误！")}}}},We=s("无"),Ke=s("过滤器默认处理接口返回值的「data」字段"),Xe=s(" 导入（json / txt） "),Ye=s(" 下载 "),Ze=s("点击【下载】查看完整数据"),et=oe({__name:"index",props:{show:{type:Boolean,required:!1},ajax:{type:Boolean,required:!0}},setup(v){const{targetData:_}=le(),x=["字段","映射","状态"],{HelpOutlineIcon:R}=O.ionicons5,{DocumentAddIcon:f,DocumentDownloadIcon:g}=O.carbon,l=S(),p=S(),i=S(),h=S(!1),{uploadFileListRef:$,customRequest:L,beforeUpload:I,download:V}=Qe(_),j=J(()=>_.value.request.requestDataType!==ge.STATIC),z=J(()=>_.value.chartConfig.chartFrame===ee.ECHARTS),m=o=>{let c=U.SUCCESS;for(let d=0;d<l.value.length;d++)if(l.value[d][o]===void 0)return c=U.FAILURE,c;return U.SUCCESS},y=()=>{try{return p.value.map((o,c)=>c===0?{field:"通用标识",mapping:o,result:U.NULL}:{field:`数据项-${c}`,mapping:o,result:m(o)})}catch(o){return[]}};return ne(()=>{var o,c;return(c=(o=_.value)==null?void 0:o.option)==null?void 0:c.dataset},o=>{var c,d;o&&((d=(c=_==null?void 0:_.value)==null?void 0:c.chartConfig)==null?void 0:d.chartFrame)===ee.ECHARTS?(l.value=o,z.value&&(p.value=o.dimensions,i.value=y())):o!=null?(i.value=null,l.value=o):(h.value=!0,l.value="此组件无数据源"),ye(o)&&(i.value=null)},{immediate:!0}),(o,c)=>{const d=a("n-badge"),u=a("n-text"),C=a("n-space"),k=a("n-table"),T=a("n-timeline-item"),q=a("n-icon"),D=a("n-button"),H=a("n-upload"),F=a("n-tooltip"),se=a("n-code"),ce=a("n-card"),re=a("n-timeline");return b(),E(re,{class:"go-chart-configurations-timeline"},{default:e(()=>[X(t(T,{type:"info",title:n(M).MAPPING},{default:e(()=>[t(k,{striped:""},{default:e(()=>[r("thead",null,[r("tr",null,[(b(),B(P,null,Z(x,w=>r("th",{key:w},N(w),1)),64))])]),r("tbody",null,[(b(!0),B(P,null,Z(i.value,(w,ie)=>(b(),B("tr",{key:ie},[r("td",null,N(w.field),1),r("td",null,N(w.mapping),1),r("td",null,[w.result===0?(b(),E(C,{key:0},{default:e(()=>[t(d,{dot:"",type:"success"}),t(u,null,{default:e(()=>[We]),_:1})]),_:1})):(b(),E(C,{key:1},{default:e(()=>[t(d,{dot:"",type:w.result===1?"success":"error"},null,8,["type"]),t(u,null,{default:e(()=>[s("匹配"+N(w.result===1?"成功":"失败"),1)]),_:2},1024)]),_:2},1024))])]))),128))])]),_:1})]),_:1},8,["title"]),[[Y,n(z)&&i.value]]),X(t(T,{color:"#97846c",title:n(M).FILTER},{default:e(()=>[t(C,{size:18,vertical:""},{default:e(()=>[t(u,{depth:"3"},{default:e(()=>[Ke]),_:1}),t(n(Ge))]),_:1})]),_:1},8,["title"]),[[Y,n(j)]]),t(T,{type:"success",title:n(M).CONTENT},{default:e(()=>[t(C,{vertical:""},{default:e(()=>[t(C,{class:"source-btn-box"},{default:e(()=>[t(H,{"file-list":n($),"onUpdate:file-list":c[0]||(c[0]=w=>we($)?$.value=w:null),"show-file-list":!1,customRequest:n(L),onBeforeUpload:n(I)},{default:e(()=>[t(C,null,{default:e(()=>[v.ajax?be("",!0):(b(),E(D,{key:0,class:"sourceBtn-item",disabled:h.value},{icon:e(()=>[t(q,null,{default:e(()=>[t(n(f))]),_:1})]),default:e(()=>[Xe]),_:1},8,["disabled"]))]),_:1})]),_:1},8,["file-list","customRequest","onBeforeUpload"]),r("div",null,[t(D,{class:"sourceBtn-item",disabled:h.value,onClick:n(V)},{icon:e(()=>[t(q,null,{default:e(()=>[t(n(g))]),_:1})]),default:e(()=>[Ye]),_:1},8,["disabled","onClick"]),t(F,{trigger:"hover"},{trigger:e(()=>[t(q,{class:"go-ml-1",size:"21",depth:3},{default:e(()=>[t(n(R))]),_:1})]),default:e(()=>[t(u,{depth:"3"},{default:e(()=>[Ze]),_:1})]),_:1})])]),_:1}),t(ce,{size:"small"},{default:e(()=>[t(se,{code:n(A)(l.value),language:"json"},null,8,["code"])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1})}}});const _t=ae(et,[["__scopeId","data-v-f6d90859"]]);export{_t as C};
