var d=(v,f,i)=>new Promise((S,u)=>{var g=a=>{try{n(i.next(a))}catch(c){u(c)}},r=a=>{try{n(i.throw(a))}catch(c){u(c)}},n=a=>a.done?S(a.value):Promise.resolve(a.value).then(g,r);n((i=i.apply(v,f)).next())});import{M as B}from"./EditorWorker-588d53ae.js";import"./editorWorker-43a98755.js";import{d as J,j as L,aJ as w,aK as M,al as R,aL as k,aM as j,aN as A,c as D,b as t,w as o,aG as F,a as s,o as y,n as G,u as m,E as x,a7 as O,e as p,h as K}from"./index-f1b62783.js";import{g as z}from"./storage-cd46cc6a.js";import"./querySelectorAll-a1c431d2.js";import{g as b}from"./plugin-a824adf1.js";import{i as H}from"./icon-14375a60.js";import{u as U}from"./useSync.hook-f803091a.js";import{u as q,P as Q}from"./chartEditStore-486ae2f4.js";import"./project.api-a6799795.js";import"./chartLayoutStore-ce407c49.js";import"./index-22e48ee0.js";import"./SettingItem-d0566dd6.js";/* empty css                                                                      */import"./SettingItemBox-6b455d4c.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-3590d83e.js";import"./index.esm.min-98f3d51a.js";import"./fileTypeEnum-21359a08.js";const W={class:"go-edit"},X=p("页面在线编辑器"),Y=p(" 导入 "),Z=p(" 「Ctrl + S 更新视图」 "),ee=p(" 保存 "),oe=J({__name:"index",setup(v){const f=q(),{dataSyncUpdate:i}=U(),{ChevronBackOutlineIcon:S,DownloadIcon:u,AnalyticsIcon:g}=H.ionicons5,r=window.showOpenFilePicker,n=L("");window.$message.warning("请不要刷新此窗口！");function a(){return d(this,null,function*(){const e=yield z();F(`编辑-${e.editCanvasConfig.projectName}`),n.value=k(e)})}setTimeout(a);function c(){b({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>d(this,null,function*(){try{const _=yield(yield r())[0].getFile(),l=new FileReader;l.readAsText(_),l.onloadend=()=>{n.value=(l.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}})})}window.opener.addEventListener(w.CHART,e=>{window.$message.success("正在进行更新..."),M(R.GO_CHART_STORAGE_LIST,[e.detail]),n.value=k(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),C())});function C(){return d(this,null,function*(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");b({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>d(this,null,function*(){try{const e=j(n.value);delete e.id,i&&(f.setProjectInfo(Q.PROJECT_ID,A()),yield i(!1)),window.opener.dispatchEvent(new CustomEvent(w.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}})})})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(w.CLOSE))},(e,_)=>{const l=s("n-text"),h=s("n-icon"),E=s("n-button"),N=s("n-tag"),P=s("n-space"),I=s("n-layout-header"),T=s("n-layout-content"),$=s("n-layout");return y(),D("div",W,[t($,null,{default:o(()=>[t(I,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:o(()=>[G("div",null,[t(l,{class:"go-edit-title go-mr-4"},{default:o(()=>[X]),_:1}),m(r)?(y(),x(E,{key:0,class:"go-mr-3",size:"medium",onClick:c},{icon:o(()=>[t(h,null,{default:o(()=>[t(m(u))]),_:1})]),default:o(()=>[Y]),_:1})):O("",!0)]),t(P,null,{default:o(()=>[t(N,{bordered:!1,type:"warning"},{default:o(()=>[Z]),_:1}),m(r)?(y(),x(E,{key:0,class:"go-mr-3",size:"medium",onClick:C},{icon:o(()=>[t(h,null,{default:o(()=>[t(m(g))]),_:1})]),default:o(()=>[ee]),_:1})):O("",!0)]),_:1})]),_:1}),t(T,null,{default:o(()=>[t(m(B),{modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=V=>n.value=V),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}});const Ce=K(oe,[["__scopeId","data-v-13e14cec"]]);export{Ce as default};
