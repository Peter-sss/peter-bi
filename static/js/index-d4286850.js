var z=(q,p,r)=>new Promise((x,o)=>{var f=c=>{try{i(r.next(c))}catch(_){o(_)}},y=c=>{try{i(r.throw(c))}catch(_){o(_)}},i=c=>c.done?x(c.value):Promise.resolve(c.value).then(f,y);i((r=r.apply(q,p)).next())});import{d as L,a0 as B,j as R,aS as E,L as P,a as n,o as O,E as J,w as t,b as e,n as D,e as l,t as w,u as a,h as A,bg as K,Q as W,a2 as X,ba as Y,cD as Z,c as ee,d2 as j,bt as te,ac as F,bu as ae}from"./index-f1b62783.js";import{i as oe}from"./icon-14375a60.js";import{S as I}from"./SettingItem-d0566dd6.js";import{S as H}from"./SettingItemBox-6b455d4c.js";import"./chartEditStore-486ae2f4.js";/* empty css                                                                      */import{u as G}from"./useTargetData.hook-27534cde.js";import{R as ne,a as se}from"./pondIndex.vue_vue_type_style_index_0_scoped_a969325e_lang-51ec6c7b.js";import{u as le}from"./useSync.hook-f803091a.js";import"./index-c88c4d15.js";import"./EditorWorker-588d53ae.js";import"./editorWorker-43a98755.js";import"./chartLayoutStore-ce407c49.js";import"./index-22e48ee0.js";import{C as re}from"./index-90003018.js";import"./plugin-a824adf1.js";import"./project.api-a6799795.js";import"./index-08a0b855.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-3590d83e.js";import"./index.esm.min-98f3d51a.js";import"./fileTypeEnum-21359a08.js";const ce={class:"go-pr-3"},de=l("—— "),ue=l("取消"),ie=L({__name:"index",props:{modelShow:Boolean,targetData:Object,saveBtnText:String||null},emits:["update:modelShow","sendHandle"],setup(q,{emit:p}){const r=q,{targetData:x}=G(),{dataSyncUpdate:o}=le(),{chartConfig:f}=B(r.targetData),{requestContentType:y}=B(r.targetData.request),i=R(!1),c={[E.DEFAULT]:"普通请求",[E.SQL]:"SQL 请求"};P(()=>r.modelShow,h=>{i.value=h},{immediate:!0});const _=()=>{p("update:modelShow",!1)},m=()=>{p("update:modelShow",!1),p("sendHandle"),o()},S=()=>{_()};return(h,C)=>{const g=n("n-space"),U=n("n-scrollbar"),v=n("n-text"),k=n("n-tag"),d=n("n-button"),s=n("n-card"),b=n("n-modal");return O(),J(b,{class:"go-chart-data-request",show:i.value,"onUpdate:show":C[0]||(C[0]=u=>i.value=u),"mask-closable":!1,closeOnEsc:!0,onEsc:S},{default:t(()=>[e(s,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(g,{justify:"space-between"},{default:t(()=>[D("div",null,[e(v,null,{default:t(()=>[l("「 "+w(a(f).categoryName)+" 」",1)]),_:1}),e(v,null,{default:t(()=>[de]),_:1}),e(k,{type:"primary",bordered:!1,style:{"border-radius":"5px"}},{default:t(()=>[l(w(c[a(y)]),1)]),_:1})]),D("div",null,[e(d,{class:"go-mr-3",onClick:_},{default:t(()=>[ue]),_:1}),e(d,{type:"primary",onClick:m},{default:t(()=>[l(w(q.saveBtnText||"保存 & 发送请求"),1)]),_:1})])]),_:1})]),default:t(()=>[e(U,{style:{"max-height":"718px"}},{default:t(()=>[D("div",ce,[e(g,{vertical:""},{default:t(()=>{var u;return[e(a(ne)),e(a(se),{"target-data-request":(u=a(x))==null?void 0:u.request},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),_e=A(ie,[["__scopeId","data-v-270d89aa"]]),pe={class:"go-chart-configurations-data-ajax"},me={class:"go-absolute-center"},fe=l("编辑配置"),he=l(" 测试 "),ge=l(" 默认赋值给 dataset 字段 "),ve=l(" 发送请求 "),be=L({__name:"index",setup(q){K(d=>({"272613bc":a(k)}));const{HelpOutlineIcon:p,FlashIcon:r,PulseIcon:x}=oe.ionicons5,{targetData:o,chartEditStore:f}=G(),{requestOriginUrl:y,requestInterval:i,requestIntervalUnit:c}=B(f.getRequestGlobalConfig),_=W(),m=R(!1),S=R(!1),h=R(!1);let C=0,g;const U=()=>{S.value=!0},v=()=>z(this,null,function*(){var d;if((d=o.value)!=null&&d.request){m.value=!0;try{const s=yield te(F(o.value.request),F(f.getRequestGlobalConfig));if(m.value=!1,s){const{data:b}=s;if(!b&&!o.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),h.value=!0;return}o.value.option.dataset=ae(b,s,o.value.filter),h.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(s){console.error(s),m.value=!1,window.$message.warning("数据异常，请检查参数！")}}}),k=X(()=>_.getAppTheme);return Y(()=>{var s;const d=(s=o.value)==null?void 0:s.filter;g!==d&&C&&(g=d,v()),C++}),Z(()=>{g=null}),(d,s)=>{const b=n("n-tag"),u=n("n-input"),T=n("n-icon"),$=n("n-button"),N=n("n-card"),Q=n("n-tooltip"),V=n("go-skeleton");return O(),ee("div",pe,[e(N,{class:"n-card-shallow"},{default:t(()=>[e(a(H),{name:"请求配置"},{default:t(()=>[e(a(I),{name:"类型"},{default:t(()=>[e(b,{bordered:!1,type:"primary",style:{"border-radius":"5px"}},{default:t(()=>[l(w(a(o).request.requestContentType===a(E).DEFAULT?"普通请求":"SQL请求"),1)]),_:1})]),_:1}),e(a(I),{name:"方式"},{default:t(()=>[e(u,{size:"small",placeholder:a(o).request.requestHttpType||"暂无",disabled:!0},null,8,["placeholder"])]),_:1}),e(a(I),{name:"组件间隔"},{default:t(()=>[e(u,{size:"small",placeholder:`${a(o).request.requestInterval||"暂无"}`,disabled:!0},{suffix:t(()=>[l(w(a(j)[a(o).request.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(I),{name:"全局间隔（默认）"},{default:t(()=>[e(u,{size:"small",placeholder:`${a(i)||"暂无"} `,disabled:!0},{suffix:t(()=>[l(w(a(j)[a(c)]),1)]),_:1},8,["placeholder"])]),_:1})]),_:1}),e(a(H),{name:"源地址",alone:!0},{default:t(()=>[e(u,{size:"small",placeholder:a(y)||"暂无",disabled:!0},{prefix:t(()=>[e(T,{component:a(x)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),e(a(H),{name:"组件地址",alone:!0},{default:t(()=>[e(u,{size:"small",placeholder:a(o).request.requestUrl||"暂无",disabled:!0},{prefix:t(()=>[e(T,{component:a(r)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1}),D("div",{class:"edit-text",onClick:U},[D("div",me,[e($,{type:"primary",secondary:""},{default:t(()=>[fe]),_:1})])])]),_:1}),e(a(H),{alone:!0},{name:t(()=>[he,e(Q,{trigger:"hover"},{trigger:t(()=>[e(T,{size:"21",depth:3},{default:t(()=>[e(a(p))]),_:1})]),default:t(()=>[ge]),_:1})]),default:t(()=>[e($,{type:"primary",ghost:"",onClick:v},{icon:t(()=>[e(T,null,{default:t(()=>[e(a(r))]),_:1})]),default:t(()=>[ve]),_:1})]),_:1}),e(a(re),{show:h.value&&!m.value,ajax:!0},null,8,["show"]),e(V,{load:m.value,repeat:3},null,8,["load"]),e(a(_e),{modelShow:S.value,"onUpdate:modelShow":s[0]||(s[0]=M=>S.value=M),targetData:a(o),onSendHandle:v},null,8,["modelShow","targetData"])])}}});const Ge=A(be,[["__scopeId","data-v-688badbe"]]);export{Ge as default};
