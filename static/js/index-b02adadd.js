var _=(v,y,i)=>new Promise((p,c)=>{var a=t=>{try{r(i.next(t))}catch(e){c(e)}},f=t=>{try{r(i.throw(t))}catch(e){c(e)}},r=t=>t.done?p(t.value):Promise.resolve(t.value).then(a,f);r((i=i.apply(v,y)).next())});import{M as A}from"./EditorWorker-d94027f7.js";import"./editorWorker-43a98755.js";import{d as I,r as V,aA as g,aB as P,S as D,aC as h,e as M,h as n,w as o,ax as F,aD as J,x as s,c as w,f as L,l as d,B as k,a2 as x,p as m,A as R}from"./index-aa7518de.js";import{g as j}from"./storage-9a9611fc.js";import"./querySelectorAll-a1c431d2.js";import{g as b}from"./plugin-2ac2d336.js";import{i as z}from"./icon-49f969d0.js";import"./chartEditStore-dcae2239.js";const G={class:"go-edit"},H=m("页面在线编辑器"),K=m(" 导入 "),U=m(" 「Ctrl + S 更新视图」 "),q=m(" 保存 "),Q=I({__name:"index",setup(v){const{ChevronBackOutlineIcon:y,DownloadIcon:i,AnalyticsIcon:p}=z.ionicons5,c=window.showOpenFilePicker,a=V("");window.$message.warning("请不要刷新此窗口！");function f(){return _(this,null,function*(){const e=yield j();F(`编辑-${e.editCanvasConfig.projectName}`),a.value=h(e)})}setTimeout(f);function r(){b({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>_(this,null,function*(){try{const u=yield(yield c())[0].getFile(),l=new FileReader;l.readAsText(u),l.onloadend=()=>{a.value=(l.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}})})}window.opener.addEventListener(g.CHART,e=>{window.$message.success("正在进行更新..."),P(D.GO_CHART_STORAGE_LIST,[e.detail]),a.value=h(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),t())});function t(){return _(this,null,function*(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");b({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{try{const e=J(a.value);delete e.id,window.opener.dispatchEvent(new CustomEvent(g.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}}})})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(g.CLOSE))},(e,u)=>{const l=s("n-text"),C=s("n-icon"),S=s("n-button"),O=s("n-tag"),E=s("n-space"),N=s("n-layout-header"),B=s("n-layout-content"),T=s("n-layout");return w(),M("div",G,[n(T,null,{default:o(()=>[n(N,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:o(()=>[L("div",null,[n(l,{class:"go-edit-title go-mr-4"},{default:o(()=>[H]),_:1}),d(c)?(w(),k(S,{key:0,class:"go-mr-3",size:"medium",onClick:r},{icon:o(()=>[n(C,null,{default:o(()=>[n(d(i))]),_:1})]),default:o(()=>[K]),_:1})):x("",!0)]),n(E,null,{default:o(()=>[n(O,{bordered:!1,type:"warning"},{default:o(()=>[U]),_:1}),d(c)?(w(),k(S,{key:0,class:"go-mr-3",size:"medium",onClick:t},{icon:o(()=>[n(C,null,{default:o(()=>[n(d(p))]),_:1})]),default:o(()=>[q]),_:1})):x("",!0)]),_:1})]),_:1}),n(B,null,{default:o(()=>[n(d(A),{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=$=>a.value=$),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}});const se=R(Q,[["__scopeId","data-v-9c28ebc7"]]);export{se as default};
